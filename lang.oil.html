<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Oil shell language</title><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script type="text/x-mathjax-config">
                MathJax = {
                    tex: {
                        inlineMath: [ [&#x27;$&#x27;,&#x27;$&#x27;], [&#x27;\(&#x27;,&#x27;\)&#x27;] ],
                        displayMath: [ [&#x27;$$&#x27;,&#x27;$$&#x27;], [&#x27;[&#x27;,&#x27;]&#x27;] ]
                    },
                    options = {
                        processHtmlClass = &quot;math&quot;
                    }
                }
                </script><meta name="next-head-count" content="6"/><link rel="preload" href="/wiki/_next/static/css/52fc2ba29703df73922c.css" as="style"/><link rel="stylesheet" href="/wiki/_next/static/css/52fc2ba29703df73922c.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/wiki/_next/static/chunks/main-ae4733327bd95c4ac325.js" as="script"/><link rel="preload" href="/wiki/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/wiki/_next/static/chunks/framework.9d524150d48315f49e80.js" as="script"/><link rel="preload" href="/wiki/_next/static/chunks/commons.0e1c3f9aa780c2dfe9f0.js" as="script"/><link rel="preload" href="/wiki/_next/static/chunks/pages/_app-8e3d0c58a60ec788aa69.js" as="script"/><link rel="preload" href="/wiki/_next/static/chunks/940643274e605e7596ecea1f2ff8d83317a3fb76.4841a16762f602a59f00.js" as="script"/><link rel="preload" href="/wiki/_next/static/chunks/pages/%5B%5B...slug%5D%5D-1aa198f87ede1cd0e1dc.js" as="script"/></head><body><div id="__next"><main><h1>Oil shell language</h1><section class="post-metadata"><span>Date: <!-- -->2021-05-09 16:40:50 +08:00</span><span>Date modified: <!-- -->2022-04-16 20:18:16 +08:00</span></section><nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h1"><a href="/wiki/lang.oil#what-is-oil-shell" class="toc-link toc-link-h1">What is Oil shell?</a></li><li class="toc-item toc-item-h1"><a href="/wiki/lang.oil#overview-of-the-oil-language" class="toc-link toc-link-h1">Overview of the Oil language</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h2"><a href="/wiki/lang.oil#strings" class="toc-link toc-link-h2">Strings</a></li><li class="toc-item toc-item-h2"><a href="/wiki/lang.oil#arrays" class="toc-link toc-link-h2">Arrays</a></li><li class="toc-item toc-item-h2"><a href="/wiki/lang.oil#conditions" class="toc-link toc-link-h2">Conditions</a></li><li class="toc-item toc-item-h2"><a href="/wiki/lang.oil#associative-arrays" class="toc-link toc-link-h2">Associative arrays</a></li></ol></li><li class="toc-item toc-item-h1"><a href="/wiki/lang.oil#expression-and-command-mode" class="toc-link toc-link-h1">Expression and command mode</a></li><li class="toc-item toc-item-h1"><a href="/wiki/lang.oil#quoted-string-notation-qsn" class="toc-link toc-link-h1">Quoted string notation (QSN)</a></li><li class="toc-item toc-item-h1"><a href="/wiki/lang.oil#structured-data" class="toc-link toc-link-h1">Structured data</a></li><li class="toc-item toc-item-h1"><a href="/wiki/lang.oil#tips-and-tricks" class="toc-link toc-link-h1">Tips and tricks</a></li></ol></nav><p>For future references, this note mainly notes Oil v0.8.11 and later versions.
Also, we&#x27;ll be comparing to Bash shell (src<sub>bash</sub>[:eval yes  :results output]{bash --version | head -n 1} {{{results(<code class="inline-verbatim">GNU bash\, version 4.4.23(1)-release (x86_64-unknown-linux-gnu)</code>)}}}) as it is the most popular shell on the Unix world.
</p><h1 id="what-is-oil-shell">What is Oil shell?</h1><p>Ripping off from the <a href="https://www.oilshell.org/blog/2020/01/simplest-explanation.html">explanation page</a>:
</p><blockquote><p>Oil is also aimed at people who know say Python or JavaScript, but purposely avoid shell.
</p></blockquote><p>A modern shell attempting the replace <a href="id:dd9d3ffa-03ff-42a1-8c5d-55dc9fcc70fe">GNU Bash</a> slowly.
The project has an ambitious goal with a wide scope.
It is known for its <a href="https://oilshell.org/blog">shell-oriented blog</a> and the developer is very responsive and active with shell-related posts.
</p><p>While there are multiple components in this project, we&#x27;re focusing on two: <strong>OSH and Oil shell</strong>.
</p><ul><li><p><strong>OSH is the bridge between Bash and Oil.</strong>
  It aims to be the most Bash-compatible shell that you can run most Bash scripts just fine.
  The point of this component is improving what&#x27;s under the hood, imposing sensible defaults on them, and getting a wide reach since Bash is the most popular shell.
  While it may not run every Bash script in existence, the other point is to require minimal rewrites to run it with OSH or eventually rewrite it in Oil.
</p></li><li><p><strong>Oil shell is the modern replacement of Bash</strong> from its syntax and behavior.
  It aims to be the shell for people familiar to Python, Ruby, JavaScript, and the like.
  This is the other side of the bridge that OSH aims to reach.
</p></li></ul><p>Both OSH and Oil are referring to the same interpreter but configured differently.
</p><h1 id="overview-of-the-oil-language">Overview of the Oil language</h1><p>Oil is an entirely new programming language built from scratch.
It adds a hint of familiarity with Bash and takes a big queue of Python.
</p><p>The following block should be sufficient for jogging your memory and a quick glance of what Oil is all about.
</p><pre class="src-block"><code class="language-oil">var title = &quot;Catenbury&#x27;s Tale&quot;
setvar title = &quot;MS Fnd in a Lbry&quot;

var keywords = %(&quot;metadata&quot; &quot;information overload&quot; &quot;information retrieval&quot;)
append :keywords &quot;information organization&quot;

var metadata = {}
setvar metadata[&#x27;author&#x27;] = &quot;Hal Draper&quot;
setvar metadata[&#x27;year&#x27;] = 1961

# Practically, it&#x27;s a function.
# Not necessarily a function since it doesn&#x27;t return an output.
proc kebab_case(word) {
  write -- $word | sed -E -e &#x27;s/./\L&amp;/g&#x27; -e &#x27;s/s+/-/g&#x27; -e &#x27;s/[^.a-z0-9-]//g&#x27; -e &#x27;s/-+/-/g&#x27;
}

var title_slug = $(kebab_case $title)

{
  var keywords = %(&quot;alternate universes&quot; &quot;aliens&quot; &quot;spaceships&quot;)
  for i in @keywords { echo &quot;keyword: $i&quot; }
}
for i in @keywords { echo &quot;keyword: $i&quot; }
</code></pre><h2 id="strings">Strings</h2><p>While strings are similar to Bash strings<!-- -->, there are subtle differences.
Most notably, Bash splits the string when trying to do something.
</p><pre class="src-block"><code class="language-bash">d=&#x27;echo 3&#x27;
e=&#x27;echo &quot;The quick brown fox jumps over the lazy dog.&quot;&#x27;

parallel -- $d $e
</code></pre><p>It should throw an error because <code class="inline-verbatim">parallel</code> interprets it as if it has 4 arguments due to the splitting — i.e., <code class="inline-code">parallel -- echo 3 echo &quot;The quick brown fox jumps over the lazy dog.&quot;</code>.
The solution here is to quote the variables in evaluation (e.g., <code class="inline-code">parallel -- &quot;$d&quot; &quot;$e&quot;</code>).
</p><p>Compare that to Oil...
</p><pre class="src-block"><code class="language-oil">var d = &#x27;echo 3&#x27;
var e = &#x27;echo &quot;The quick brown fox jumps over the lazy dog.&quot;&#x27;

parallel -- $d $e
</code></pre><p>If you want splitting, you could use <code class="inline-verbatim">split</code> Oil function — e.g., <code class="inline-code">@split(array_var)</code>.
</p><h2 id="arrays">Arrays</h2><p>Arrays are mostly similar to Bash arrays except you have more options.
</p><ul><li><p>You can create a heterogenous list containing different types of data — e.g., <code class="inline-code">var a = [&#x27;Dogs&#x27;, 24, true ]</code>.
  Useful for JSON compatibility.
</p></li><li><p>A homogenous array is useful for data consistency.
  It can accept a list of data of the same type — e.g., <code class="inline-code">var b = %(&quot;foo&quot; &quot;bar&quot; &quot;baz&quot;)</code>.
</p></li></ul><p>You can iterate through an array with a loop.
</p><pre class="src-block"><code class="language-oil">for i in @a { echo &quot;word: $i&quot; }
</code></pre><p>You can also add an item to the array with <code class="inline-verbatim">append</code> keyword.
</p><pre class="src-block"><code class="language-oil">append :a &quot;biz&quot;

# The expression mode equivalent
# You can also append associative arrays due to the expressiveness of the mode
_ a.append(&quot;biz&quot;)
</code></pre><h2 id="conditions">Conditions</h2><p>Conditions in Oil look like this...
Note that the parenthesis is a part of it.
</p><pre class="src-block"><code class="language-oil">if (4 == 5) {
  echo &quot;Alright, this is true.&quot;
} elif (1 &gt; 5) {
  echo &quot;Another condition?&quot;
} else {
  echo &quot;It seems you got me.&quot;
}
</code></pre><p>You can also make ternary conditionals.
</p><pre class="src-block"><code class="language-oil">echo $[&#x27;dogs&#x27; if dogs == &#x27;cute&#x27; else &#x27;cats&#x27;]
</code></pre><p>While Oil expressions are usually used for conditions, you can also use command mode lines (see <a href="/wiki/Expression%20and%20command%20mode">Expression and command mode</a>).
Similar to Bash conditions, it will pass when the exit code is zero.
</p><pre class="src-block"><code class="language-oil">if test -d /usr/home {
  echo &quot;OK, you have an unusual home.&quot;
} elif test -d /home {
  echo &quot;Alrighty, home does exist.&quot;
} else {
  echo &quot;Homeless.&quot;
}
</code></pre><h2 id="associative-arrays">Associative arrays</h2><ul><li><p>similar to Bash associative arrays or Python dictionaries (practically like Python dictionaries)
</p></li><li><p>when interacting with Oil, an associative array is exactly that, an array
</p></li></ul><pre class="src-block"><code class="language-oil">const conditions = {}
setvar conditions[&#x27;sunny&#x27;] = 80
setvar conditions[&#x27;cloudy&#x27;] = 30
setvar conditions[&#x27;rainy&#x27;] = -20

for key in @conditions {
  write -- $key $[conditions[key]]
}
</code></pre><p>You can check for a member in an associative with <code class="inline-verbatim">in</code> keyword.
</p><pre class="src-block"><code class="language-oil">if (&#x27;rainy&#x27; in conditions) {
  write -- &quot;We have rainy days over here.&quot;
}
</code></pre><h1 id="expression-and-command-mode">Expression and command mode</h1><ul><li><p>There are different ways <a href="https://www.oilshell.org/release/latest/doc/syntactic-concepts.html">how Oil can create an expressive language with the shell</a>.
  It can parse different sublanguages with different lexer modes.
  But there are dominantly two modes to keep in mind: expression and command mode.
</p></li><li><p>simply put:
</p><ul><li><p><strong>command mode is similar to Bash expressions</strong></p></li><li><p><strong>expression mode is akin to Python expressions</strong></p></li></ul></li><li><p>Expression mode even has Python familiarisms — e.g., <code class="inline-code">if (&quot;item&quot; in array)</code>, <code class="inline-code">if (&quot;key&quot; in object)</code>.
</p></li><li><p>The addition of a Python-like expressiveness is how Oil can make a rich scripting exprience.
</p></li><li><p>command mode is what you see most of the time
</p></li><li><p>expression mode is activated when:
</p><ul><li><p>right-hand side of <code class="inline-verbatim">=</code> — e.g., <code class="inline-code">var a = 234</code></p></li><li><p>the <code class="inline-verbatim">_</code> keyword where output will be ignored — e.g., <code class="inline-code">_ a.append(b)</code></p></li><li><p>the <code class="inline-verbatim">=</code> command where it will print the results — e.g., <code class="inline-code">= 53</code></p></li><li><p>you can interpolate expression mode expressions with <code class="inline-verbatim">$[]</code> — e.g., <code class="inline-code">echo $[4 + 43 + a]</code>, <code class="inline-code">echo $[len(ARGV)]</code></p></li><li><p>in <code class="inline-verbatim">if</code> statements — e.g., <code class="inline-code">if (true) { echo &quot;WHOA&quot; }</code></p></li></ul></li></ul><h1 id="quoted-string-notation-qsn">Quoted string notation (QSN)</h1><ul><li><p>a data format that can represent any byte sequence
</p></li><li><p>adapted from Rust&#x27;s string syntax
</p></li><li><p>Oil can print non-ASCII stuff through <a href="https://www.oilshell.org/release/latest/doc/qsn.html">QSN</a></p></li></ul><pre class="src-block"><code class="language-oil">write -- $&#x27;\u044f\u043c\u0443&#x27; $&#x27;\u3bc&#x27;
</code></pre><h1 id="structured-data">Structured data</h1><p>While Bash have support for structured data such as arrays and associative arrays, it does not go any further such as not letting you assign arrays in an item.
As of v0.8.9, Oil also comes with the same problem but it seems <a href="https://github.com/oilshell/oil/issues/741">the developer is also interested in solving that</a>.
</p><p>Though, you can still declare and assign variables with nested data structures.
</p><pre class="src-block"><code class="language-oil">const author = {
  &quot;name&quot;: &quot;John Doe&quot;,
  &quot;birthdate&quot;: &quot;1992-04-04&quot;,
  &quot;portfolio&quot;: [
    { &quot;title&quot;: &quot;Philistine: A Jon Doe story&quot;, &quot;isbn&quot;: &quot;392-423-2113-123&quot; },
    { &quot;title&quot;: &quot;Whoa there!&quot;, &quot;isbn&quot;: &quot;241-123-35241-123&quot; }
  ]
  &quot;has_criminal_record&quot;: false
}

write -- $[author[&#x27;name&#x27;]] $[author[&#x27;portfolio&#x27;][0][&#x27;title&#x27;]]
</code></pre><p>Oil has a built-in JSON support with the <code class="inline-verbatim">json</code> keyword.
</p><pre class="src-block"><code class="language-oil">const author = {
  &quot;name&quot;: &quot;John Doe&quot;,
  &quot;birthdate&quot;: &quot;1992-04-04&quot;,
  &quot;portfolio&quot;: [
    { &quot;title&quot;: &quot;Philistine: A Jon Doe story&quot;, &quot;isbn&quot;: &quot;392-423-2113-123&quot; },
    { &quot;title&quot;: &quot;Whoa there!&quot;, &quot;isbn&quot;: &quot;241-123-35241-123&quot; }
  ]
  &quot;has_criminal_record&quot;: false
}

json write :author
</code></pre><p>This is handy as most tools has an option to print JSON data — e.g., <code class="inline-verbatim">systemctl</code>, Ripgrep, <code class="inline-verbatim">buku</code>, <a href="/wiki/cli.borg">BorgBackup</a>.
</p><h1 id="tips-and-tricks">Tips and tricks</h1><ul><li><p>Oil seems to evaluate in normal order, evaluating only when the conditions passed — e.g., <code class="inline-code">echo $[&#x27;&#x27; + null if null else &#x27;EEEEHHH&#x27;]</code> should print <code class="inline-verbatim">EEEEHHH</code>.
</p><ul><li><p>Just like most modern mainstream languages... nice.
</p></li></ul></li><li><p>Two operands of different types are considered unequal — e.g., <code class="inline-code">&#x27;4&#x27; == 4</code>.
</p><ul><li><p>You can use Python-like type conversions like <code class="inline-verbatim">Int</code>, <code class="inline-verbatim">Bool</code>, and <code class="inline-verbatim">Str</code> — e.g., <code class="inline-code">Int(&#x27;4&#x27;) == 4</code>.
</p></li></ul></li><li><p>By default, errexit is disabled (e.g., the script will not exit on error).
  You can have fine control over it with <code class="inline-verbatim">run</code>.
</p></li></ul></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metadata":{"date":"\"2021-05-09 16:40:50 +08:00\"","date_modified":"\"2022-04-16 20:18:16 +08:00\"","language":"en","source":""},"title":"Oil shell language","hast":{"type":"root","children":[{"type":"element","tagName":"nav","properties":{"className":"toc"},"children":[{"type":"element","tagName":"ol","properties":{"className":"toc-level toc-level-1"},"children":[{"type":"element","tagName":"li","data":{"hookArgs":[{"type":"element","tagName":"h1","properties":{"id":"what-is-oil-shell"},"children":[{"type":"text","value":"What is Oil shell?"}]}]},"properties":{"className":"toc-item toc-item-h1"},"children":[{"type":"element","tagName":"a","properties":{"className":"toc-link toc-link-h1","href":"/lang.oil#what-is-oil-shell"},"children":[{"type":"text","value":"What is Oil shell?"}]}]},{"type":"element","tagName":"li","data":{"hookArgs":[{"type":"element","tagName":"h1","properties":{"id":"overview-of-the-oil-language"},"children":[{"type":"text","value":"Overview of the Oil language"}]}]},"properties":{"className":"toc-item toc-item-h1"},"children":[{"type":"element","tagName":"a","properties":{"className":"toc-link toc-link-h1","href":"/lang.oil#overview-of-the-oil-language"},"children":[{"type":"text","value":"Overview of the Oil language"}]},{"type":"element","tagName":"ol","properties":{"className":"toc-level toc-level-2"},"children":[{"type":"element","tagName":"li","data":{"hookArgs":[{"type":"element","tagName":"h2","properties":{"id":"strings"},"children":[{"type":"text","value":"Strings"}]}]},"properties":{"className":"toc-item toc-item-h2"},"children":[{"type":"element","tagName":"a","properties":{"className":"toc-link toc-link-h2","href":"/lang.oil#strings"},"children":[{"type":"text","value":"Strings"}]}]},{"type":"element","tagName":"li","data":{"hookArgs":[{"type":"element","tagName":"h2","properties":{"id":"arrays"},"children":[{"type":"text","value":"Arrays"}]}]},"properties":{"className":"toc-item toc-item-h2"},"children":[{"type":"element","tagName":"a","properties":{"className":"toc-link toc-link-h2","href":"/lang.oil#arrays"},"children":[{"type":"text","value":"Arrays"}]}]},{"type":"element","tagName":"li","data":{"hookArgs":[{"type":"element","tagName":"h2","properties":{"id":"conditions"},"children":[{"type":"text","value":"Conditions"}]}]},"properties":{"className":"toc-item toc-item-h2"},"children":[{"type":"element","tagName":"a","properties":{"className":"toc-link toc-link-h2","href":"/lang.oil#conditions"},"children":[{"type":"text","value":"Conditions"}]}]},{"type":"element","tagName":"li","data":{"hookArgs":[{"type":"element","tagName":"h2","properties":{"id":"associative-arrays"},"children":[{"type":"text","value":"Associative arrays"}]}]},"properties":{"className":"toc-item toc-item-h2"},"children":[{"type":"element","tagName":"a","properties":{"className":"toc-link toc-link-h2","href":"/lang.oil#associative-arrays"},"children":[{"type":"text","value":"Associative arrays"}]}]}]}]},{"type":"element","tagName":"li","data":{"hookArgs":[{"type":"element","tagName":"h1","properties":{"id":"expression-and-command-mode"},"children":[{"type":"text","value":"Expression and command mode"}]}]},"properties":{"className":"toc-item toc-item-h1"},"children":[{"type":"element","tagName":"a","properties":{"className":"toc-link toc-link-h1","href":"/lang.oil#expression-and-command-mode"},"children":[{"type":"text","value":"Expression and command mode"}]}]},{"type":"element","tagName":"li","data":{"hookArgs":[{"type":"element","tagName":"h1","properties":{"id":"quoted-string-notation-qsn"},"children":[{"type":"text","value":"Quoted string notation (QSN)"}]}]},"properties":{"className":"toc-item toc-item-h1"},"children":[{"type":"element","tagName":"a","properties":{"className":"toc-link toc-link-h1","href":"/lang.oil#quoted-string-notation-qsn"},"children":[{"type":"text","value":"Quoted string notation (QSN)"}]}]},{"type":"element","tagName":"li","data":{"hookArgs":[{"type":"element","tagName":"h1","properties":{"id":"structured-data"},"children":[{"type":"text","value":"Structured data"}]}]},"properties":{"className":"toc-item toc-item-h1"},"children":[{"type":"element","tagName":"a","properties":{"className":"toc-link toc-link-h1","href":"/lang.oil#structured-data"},"children":[{"type":"text","value":"Structured data"}]}]},{"type":"element","tagName":"li","data":{"hookArgs":[{"type":"element","tagName":"h1","properties":{"id":"tips-and-tricks"},"children":[{"type":"text","value":"Tips and tricks"}]}]},"properties":{"className":"toc-item toc-item-h1"},"children":[{"type":"element","tagName":"a","properties":{"className":"toc-link toc-link-h1","href":"/lang.oil#tips-and-tricks"},"children":[{"type":"text","value":"Tips and tricks"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For future references, this note mainly notes Oil v0.8.11 and later versions.\nAlso, we'll be comparing to Bash shell (src"},{"type":"element","tagName":"sub","properties":{},"children":[{"type":"text","value":"bash"}]},{"type":"text","value":"[:eval yes  :results output]{bash --version | head -n 1} {{{results("},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"GNU bash\\, version 4.4.23(1)-release (x86_64-unknown-linux-gnu)"}]},{"type":"text","value":")}}}) as it is the most popular shell on the Unix world.\n"}]},{"type":"element","tagName":"h1","properties":{"id":"what-is-oil-shell"},"children":[{"type":"text","value":"What is Oil shell?"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ripping off from the "},{"type":"element","tagName":"a","properties":{"href":"https://www.oilshell.org/blog/2020/01/simplest-explanation.html"},"children":[{"type":"text","value":"explanation page"}]},{"type":"text","value":":\n"}]},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Oil is also aimed at people who know say Python or JavaScript, but purposely avoid shell.\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A modern shell attempting the replace "},{"type":"element","tagName":"a","properties":{"href":"id:dd9d3ffa-03ff-42a1-8c5d-55dc9fcc70fe"},"children":[{"type":"text","value":"GNU Bash"}]},{"type":"text","value":" slowly.\nThe project has an ambitious goal with a wide scope.\nIt is known for its "},{"type":"element","tagName":"a","properties":{"href":"https://oilshell.org/blog"},"children":[{"type":"text","value":"shell-oriented blog"}]},{"type":"text","value":" and the developer is very responsive and active with shell-related posts.\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"While there are multiple components in this project, we're focusing on two: "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"OSH and Oil shell"}]},{"type":"text","value":".\n"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"OSH is the bridge between Bash and Oil."}]},{"type":"text","value":"\n  It aims to be the most Bash-compatible shell that you can run most Bash scripts just fine.\n  The point of this component is improving what's under the hood, imposing sensible defaults on them, and getting a wide reach since Bash is the most popular shell.\n  While it may not run every Bash script in existence, the other point is to require minimal rewrites to run it with OSH or eventually rewrite it in Oil.\n"}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Oil shell is the modern replacement of Bash"}]},{"type":"text","value":" from its syntax and behavior.\n  It aims to be the shell for people familiar to Python, Ruby, JavaScript, and the like.\n  This is the other side of the bridge that OSH aims to reach.\n"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Both OSH and Oil are referring to the same interpreter but configured differently.\n"}]},{"type":"element","tagName":"h1","properties":{"id":"overview-of-the-oil-language"},"children":[{"type":"text","value":"Overview of the Oil language"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Oil is an entirely new programming language built from scratch.\nIt adds a hint of familiarity with Bash and takes a big queue of Python.\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The following block should be sufficient for jogging your memory and a quick glance of what Oil is all about.\n"}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-oil"]},"children":[{"type":"text","value":"var title = \"Catenbury's Tale\"\nsetvar title = \"MS Fnd in a Lbry\"\n\nvar keywords = %(\"metadata\" \"information overload\" \"information retrieval\")\nappend :keywords \"information organization\"\n\nvar metadata = {}\nsetvar metadata['author'] = \"Hal Draper\"\nsetvar metadata['year'] = 1961\n\n# Practically, it's a function.\n# Not necessarily a function since it doesn't return an output.\nproc kebab_case(word) {\n  write -- $word | sed -E -e 's/./\\L\u0026/g' -e 's/s+/-/g' -e 's/[^.a-z0-9-]//g' -e 's/-+/-/g'\n}\n\nvar title_slug = $(kebab_case $title)\n\n{\n  var keywords = %(\"alternate universes\" \"aliens\" \"spaceships\")\n  for i in @keywords { echo \"keyword: $i\" }\n}\nfor i in @keywords { echo \"keyword: $i\" }\n"}]}]},{"type":"element","tagName":"h2","properties":{"id":"strings"},"children":[{"type":"text","value":"Strings"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"While strings are similar to Bash strings"},{"type":"text","value":", there are subtle differences.\nMost notably, Bash splits the string when trying to do something.\n"}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"d='echo 3'\ne='echo \"The quick brown fox jumps over the lazy dog.\"'\n\nparallel -- $d $e\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It should throw an error because "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"parallel"}]},{"type":"text","value":" interprets it as if it has 4 arguments due to the splitting — i.e., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"parallel -- echo 3 echo \"The quick brown fox jumps over the lazy dog.\""}]},{"type":"text","value":".\nThe solution here is to quote the variables in evaluation (e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"parallel -- \"$d\" \"$e\""}]},{"type":"text","value":").\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Compare that to Oil...\n"}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-oil"]},"children":[{"type":"text","value":"var d = 'echo 3'\nvar e = 'echo \"The quick brown fox jumps over the lazy dog.\"'\n\nparallel -- $d $e\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you want splitting, you could use "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"split"}]},{"type":"text","value":" Oil function — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"@split(array_var)"}]},{"type":"text","value":".\n"}]},{"type":"element","tagName":"h2","properties":{"id":"arrays"},"children":[{"type":"text","value":"Arrays"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Arrays are mostly similar to Bash arrays except you have more options.\n"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can create a heterogenous list containing different types of data — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"var a = ['Dogs', 24, true ]"}]},{"type":"text","value":".\n  Useful for JSON compatibility.\n"}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A homogenous array is useful for data consistency.\n  It can accept a list of data of the same type — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"var b = %(\"foo\" \"bar\" \"baz\")"}]},{"type":"text","value":".\n"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can iterate through an array with a loop.\n"}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-oil"]},"children":[{"type":"text","value":"for i in @a { echo \"word: $i\" }\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can also add an item to the array with "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"append"}]},{"type":"text","value":" keyword.\n"}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-oil"]},"children":[{"type":"text","value":"append :a \"biz\"\n\n# The expression mode equivalent\n# You can also append associative arrays due to the expressiveness of the mode\n_ a.append(\"biz\")\n"}]}]},{"type":"element","tagName":"h2","properties":{"id":"conditions"},"children":[{"type":"text","value":"Conditions"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Conditions in Oil look like this...\nNote that the parenthesis is a part of it.\n"}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-oil"]},"children":[{"type":"text","value":"if (4 == 5) {\n  echo \"Alright, this is true.\"\n} elif (1 \u003e 5) {\n  echo \"Another condition?\"\n} else {\n  echo \"It seems you got me.\"\n}\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can also make ternary conditionals.\n"}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-oil"]},"children":[{"type":"text","value":"echo $['dogs' if dogs == 'cute' else 'cats']\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"While Oil expressions are usually used for conditions, you can also use command mode lines (see "},{"type":"element","tagName":"a","properties":{"href":"/Expression%20and%20command%20mode"},"children":[{"type":"text","value":"Expression and command mode"}]},{"type":"text","value":").\nSimilar to Bash conditions, it will pass when the exit code is zero.\n"}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-oil"]},"children":[{"type":"text","value":"if test -d /usr/home {\n  echo \"OK, you have an unusual home.\"\n} elif test -d /home {\n  echo \"Alrighty, home does exist.\"\n} else {\n  echo \"Homeless.\"\n}\n"}]}]},{"type":"element","tagName":"h2","properties":{"id":"associative-arrays"},"children":[{"type":"text","value":"Associative arrays"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"similar to Bash associative arrays or Python dictionaries (practically like Python dictionaries)\n"}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"when interacting with Oil, an associative array is exactly that, an array\n"}]}]}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-oil"]},"children":[{"type":"text","value":"const conditions = {}\nsetvar conditions['sunny'] = 80\nsetvar conditions['cloudy'] = 30\nsetvar conditions['rainy'] = -20\n\nfor key in @conditions {\n  write -- $key $[conditions[key]]\n}\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can check for a member in an associative with "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"in"}]},{"type":"text","value":" keyword.\n"}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-oil"]},"children":[{"type":"text","value":"if ('rainy' in conditions) {\n  write -- \"We have rainy days over here.\"\n}\n"}]}]},{"type":"element","tagName":"h1","properties":{"id":"expression-and-command-mode"},"children":[{"type":"text","value":"Expression and command mode"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are different ways "},{"type":"element","tagName":"a","properties":{"href":"https://www.oilshell.org/release/latest/doc/syntactic-concepts.html"},"children":[{"type":"text","value":"how Oil can create an expressive language with the shell"}]},{"type":"text","value":".\n  It can parse different sublanguages with different lexer modes.\n  But there are dominantly two modes to keep in mind: expression and command mode.\n"}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"simply put:\n"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"command mode is similar to Bash expressions"}]}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"expression mode is akin to Python expressions"}]}]}]}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Expression mode even has Python familiarisms — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"if (\"item\" in array)"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"if (\"key\" in object)"}]},{"type":"text","value":".\n"}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The addition of a Python-like expressiveness is how Oil can make a rich scripting exprience.\n"}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"command mode is what you see most of the time\n"}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"expression mode is activated when:\n"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"right-hand side of "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"var a = 234"}]}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"the "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"_"}]},{"type":"text","value":" keyword where output will be ignored — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"_ a.append(b)"}]}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"the "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" command where it will print the results — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"= 53"}]}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"you can interpolate expression mode expressions with "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"$[]"}]},{"type":"text","value":" — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"echo $[4 + 43 + a]"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"echo $[len(ARGV)]"}]}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"in "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" statements — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"if (true) { echo \"WHOA\" }"}]}]}]}]}]}]},{"type":"element","tagName":"h1","properties":{"id":"quoted-string-notation-qsn"},"children":[{"type":"text","value":"Quoted string notation (QSN)"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"a data format that can represent any byte sequence\n"}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"adapted from Rust's string syntax\n"}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Oil can print non-ASCII stuff through "},{"type":"element","tagName":"a","properties":{"href":"https://www.oilshell.org/release/latest/doc/qsn.html"},"children":[{"type":"text","value":"QSN"}]}]}]}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-oil"]},"children":[{"type":"text","value":"write -- $'\\u044f\\u043c\\u0443' $'\\u3bc'\n"}]}]},{"type":"element","tagName":"h1","properties":{"id":"structured-data"},"children":[{"type":"text","value":"Structured data"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"While Bash have support for structured data such as arrays and associative arrays, it does not go any further such as not letting you assign arrays in an item.\nAs of v0.8.9, Oil also comes with the same problem but it seems "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/oilshell/oil/issues/741"},"children":[{"type":"text","value":"the developer is also interested in solving that"}]},{"type":"text","value":".\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Though, you can still declare and assign variables with nested data structures.\n"}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-oil"]},"children":[{"type":"text","value":"const author = {\n  \"name\": \"John Doe\",\n  \"birthdate\": \"1992-04-04\",\n  \"portfolio\": [\n    { \"title\": \"Philistine: A Jon Doe story\", \"isbn\": \"392-423-2113-123\" },\n    { \"title\": \"Whoa there!\", \"isbn\": \"241-123-35241-123\" }\n  ]\n  \"has_criminal_record\": false\n}\n\nwrite -- $[author['name']] $[author['portfolio'][0]['title']]\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Oil has a built-in JSON support with the "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"json"}]},{"type":"text","value":" keyword.\n"}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-oil"]},"children":[{"type":"text","value":"const author = {\n  \"name\": \"John Doe\",\n  \"birthdate\": \"1992-04-04\",\n  \"portfolio\": [\n    { \"title\": \"Philistine: A Jon Doe story\", \"isbn\": \"392-423-2113-123\" },\n    { \"title\": \"Whoa there!\", \"isbn\": \"241-123-35241-123\" }\n  ]\n  \"has_criminal_record\": false\n}\n\njson write :author\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is handy as most tools has an option to print JSON data — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"systemctl"}]},{"type":"text","value":", Ripgrep, "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"buku"}]},{"type":"text","value":", "},{"type":"element","tagName":"a","properties":{"href":"/cli.borg"},"children":[{"type":"text","value":"BorgBackup"}]},{"type":"text","value":".\n"}]},{"type":"element","tagName":"h1","properties":{"id":"tips-and-tricks"},"children":[{"type":"text","value":"Tips and tricks"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Oil seems to evaluate in normal order, evaluating only when the conditions passed — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"echo $['' + null if null else 'EEEEHHH']"}]},{"type":"text","value":" should print "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"EEEEHHH"}]},{"type":"text","value":".\n"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Just like most modern mainstream languages... nice.\n"}]}]}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Two operands of different types are considered unequal — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"'4' == 4"}]},{"type":"text","value":".\n"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can use Python-like type conversions like "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"Int"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"Bool"}]},{"type":"text","value":", and "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"Str"}]},{"type":"text","value":" — e.g., "},{"type":"element","tagName":"code","properties":{"className":["inline-code"]},"children":[{"type":"text","value":"Int('4') == 4"}]},{"type":"text","value":".\n"}]}]}]}]},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"By default, errexit is disabled (e.g., the script will not exit on error).\n  You can have fine control over it with "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"run"}]},{"type":"text","value":".\n"}]}]}]}]},"backlinks":[]},"__N_SSG":true},"page":"/[[...slug]]","query":{"slug":["lang.oil"]},"buildId":"Ie9t5zutrXP6Of75Cb5xF","assetPrefix":"/wiki","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/wiki/_next/static/chunks/polyfills-99d808df29361cf7ffb1.js"></script><script src="/wiki/_next/static/chunks/main-ae4733327bd95c4ac325.js" async=""></script><script src="/wiki/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/wiki/_next/static/chunks/framework.9d524150d48315f49e80.js" async=""></script><script src="/wiki/_next/static/chunks/commons.0e1c3f9aa780c2dfe9f0.js" async=""></script><script src="/wiki/_next/static/chunks/pages/_app-8e3d0c58a60ec788aa69.js" async=""></script><script src="/wiki/_next/static/chunks/940643274e605e7596ecea1f2ff8d83317a3fb76.4841a16762f602a59f00.js" async=""></script><script src="/wiki/_next/static/chunks/pages/%5B%5B...slug%5D%5D-1aa198f87ede1cd0e1dc.js" async=""></script><script src="/wiki/_next/static/Ie9t5zutrXP6Of75Cb5xF/_buildManifest.js" async=""></script><script src="/wiki/_next/static/Ie9t5zutrXP6Of75Cb5xF/_ssgManifest.js" async=""></script></body></html>